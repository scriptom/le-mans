<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\DB;

class ReportecuatroController extends Controller
{
    public function consultar()
    {
        $anos= DB::SELECT("select * from consultar_anos()");
        return view('reportecuatro.consultar')
        ->with('anos',$anos);
    }

    public function resultados(Request $request)
    {
        // $hex='{"\\xffd8ffe000104a46494600010100000100010000ffdb008400090909181718201a1a222527252725252a282025222723282025272020252225221f201f1d25252525251f1d1d251f1f1f1d251d251d1d1d1d1d1d1e1d1d1d1d01080506050505070505050707070809100c07090908090d0c0909100c0f100e0e0e0c0d1017100f0e140e0b0d111f1116181a1c1c1c09102125211b24171c1c1bffc000110800ee00d403012200021101031101ffc4001c0000020203010100000000000000000000050604070002030108ffc4003a10000103020404030605040202030000000100020304110512213106415161227181133291a1b1f0142342c1d1075262e172f12434151633ffc40014010100000000000000000000000000000000ffc40014110100000000000000000000000000000000ffda000c03010002110311003f0033558dc8c9080ba0e2676ce09731a92d21424545c84161c5c44c3c9168eb58ed556a1a6ca7415e6d9503dc2e8dceb5c22bf83005c2aef0f23db0d7556466f05fb201b53311a0f92559b122d7108e539b937296f1f8f2deda20931bc3f75acd83e71d12c50d710754dd498db3677c50053833a33bdd7464e19ba3b3d6b1e6cdf82095585120941bc5366d974aa885b543a8465706a758206bdbb20446cc015df42537330489dad96b270fb2fa200f414adccd36e6ac50df0a05061796c9883344151e2d2b9929b12861c46668d1d74cb8ee14f32175b44aef88b4d8a060c271a945b314c9371106ee1570d710b9c85ce22e4dbcd05c5458e46e03546bda82a8785d670d4ee15d945ee0f2410ea6a63bd890b8b4b395925f1369225f6d4386ce3f1416a9a769e8b1564311a8e4e2b1047c71b73741b0f89d248d011faf6179b05be05465928720b0b0fe1d665b941f1ce1c0c697b3421380c4a3637c46c866218bc6e6900dc14155d054bbdab491cd5a5ffc80c9e891a9e06e62a7bdc5de1404282b41795171d667695d60a50c19902c4311bb8b0e9640bd18b69cd47fc6bcde3ca43eda77f2ba96fc31ef05ccf780ccde8f6f3b771cc28d58c2f63678c1ccc2330e84208f498cc94d27e65dc46edfbe47af24f74bc6d4d20caf6b986db9d479df7b7a248c4e9e297f3c3b25c6a0ea4387ec83cd501cc0d2e6b80bdb4b3bd1d6f9202d8ae3d776687af3e7dc594fc3f8c640db1b34fc9229603add63630762105e984d7cb9001670ea39f52a4d4e3ee8cd8b5545836332d39d0bb2f63eef7e9f14e278d18f696bdbe2e4e2343dc81b5bb2074a6e2863b42084d1498831fb1552b310739a5d923706ee58f1988ea1a77f8dd1cc0f1781d28631e2ff00da74f4f340fd5b00734dd54b8b119c80add9c8c8554d56ccd365410e3a4b851a58f29b2798686ccd927571b38a08718f10f30aecc3ff00fcc792a45b2ebaab5b0bc55becc0b8d902a715b7c695a27788260e28ab0f75c24ef6e81fe2a10468b108a3c78358013aac41c049a94568aa5ad3aa5d86c4ad8c681beb6ad8e6a5765c0d0a8af2e0b5f6e504cf6d6d94ca79dce28489cdb509f300a06db314022beb5cc616f555cd6571328cfa8b5891b83c8fef6566715b581b63e847c954352fb9b7c7cfa840cd8663ff0087191e0bc03763dbbb0ff0798d940aee2025ee2c01b9b7b733d7b25a738b6e05d687aa09525592ebebea6f751dc1db8d8f2e8a4c50e61fc7edfc2e9143979dc1e7fb1e8500e636fa723f55b3c58ea8f0c2cb6cedda7eec7a79adeb70c192e397dfc7ebba006c3a9b9e5f7a2ec416d87cf97aa8ae88e857561396df7a20d6395d1bf330d97b1620f6bb3b4ebbdfbadaa6d76bba8d472f4425fa3b4417260bc78e95beca6003b9386c7cd121497767eea8c8a429c308e2c9216643e21cafc905e1056b6c815761cd75cf54a9056baf986c75b2668f10b8d5009a4c10c8f20270a7e14ca3de3e4bde1c906675faa77ba0a8f1be1d2db9dd2cc7855f55746261af16b84a12421a3708124501e8b158f49046e603a2c4159d11530119b54229a6b29c6f7ba0ef31d10b0e531eeb951030a092d4d5876379196293dc2ca4b1e2dba0cc6ab0c849074e97490f96e76d533564b669b74495ed0126c824c874b15b36ec1702e3ef42b866b6df35369a7f4d363a83f7cae80950c4c37236e63a7a6fa72216f3c02f985883bb6fef0eadb7308535ec0f045d87aeb6f88e5d8ec8854e76d89b34ef986ad7743a6c7b8df9a0974d54183475c1d8dbde1d0f71cf65b8c41a086bb63f2e9e9cbb25d92a2cebb74b9b96f2079dbb15a4d335ecb0b8d6fd876fdd017742d2c7ea3437fbecb83a1cb73bdac7d3991f1423dbb8004f929b157fe93cc69f441caaa3cb76743707fc4a8138bd885226aabe5bf219573732cd411221baf18e5d98db02a35d03c50e2c0b35e5a7c14c38d81cd22d34b66b87aae466282caa2e29313ae116aafea23c8b342a7bdb15e190a0b065e3394dd0f9389247734981c56cd40d91e3d334583962585881de361ba2e2416bae3195cde838c93eaa24b5f6e4a53805cdf002100c9316511d8b151310a0734e884ba2720342bb36879a15980360b7a365c9bf45d25620e61f6526378e57f8ae74f1b4ef7f4447f0608b806dd4a0914b16622c2faec7f85bd531cc76402cde40f2f23cc765e53504bef345c79ea8b494a646ea0dfa13a1fa1f228145f11d6fa28e4dbef74f549827b5d2ce1e66ff00028acbc16d6b75b83d7f621020d04225bb33007a1e6a24f4ae6120f2dbbf914c7270db875b83a11b14622c2b3b435e751cf7415f5b5ba2150e696b6c8dd660767d81160a3cd84e9a7a840b323d460a7d4536550b2941269af7bae6f8d10a1a7b9d54d7618e3b2004235991318c28aed160a815acb631909c5982ae55b416d102ab58b114fc2af50313272578f90a2020016a6008065caeac96ca43e30028a214120b83b71751a7a561e4a4e4d17024a01ada102e7b73e6a24b4fd51d7c5760bf55abe8af61cfba0014ccc96772bee99aa6aa2932839ac3a6810ffc0720de7baf5b4ae63ae437b5cdfe5fb20254d29738060cadeffaac9c61a6f0eaebfa25ca2a7bd8ee7b8b0f409aa960777406b098035d6007c3645b151e1d02f28612371ff4bb622dbe83e3d10573553104e85418a7f16d64c1550dddfba812c01005aeab6e7d3d5636669eca5fe15a4ae52d3b40d39a059c4210e3605007d36974cb51010ed7651ea21194f92017808bc87c938644b9c3b0f8dc4a6eca823645d581740d5e5b541a0d10eae1a230e010aaf174020f92c5e85880c09578f99709080a3bca090cd4a945b650e9df7d110b20d1cdd345cdb2321699640481cba95d145af67b474316b62eb91e480fc324554cd0163b717160eecbacd431bc6848207881edcfc91e3870998d8c103cfb745ce1c35d4ef21cf0f07636d479d902e4746db68a44180eb98947a3a185af05ce0db9d01d9c7a76ec8e160dac8045352b182d608b4315c68a1c8403daebc93107376b202f1b88e6bbbea1ced0db649d3d6dbc59879734befe2f6b0fbc0f6fe6fb2071a98d089223f7fc2870f16324b02db77eff00353fdbb5c2e104095bc90caa07f4825132f6b439c4171be8029b0b9b6be83a2053761b21f7bfd85da7a46816f4ba97886311b1def0f42879c5239458141e6114d9187cca2610ec168279b3bd83c2091f04c6de1daa3cac80659737a628f846a1db943ebf02920d5da84025a540ac1a29e541ad1a200a02c5cc9588257b42b9be45d5c05943282740e443f1081fb75b32a2e8097b74469180bd8e3cae102ba2d871274e6351dfa84195925454cc6182fe7d3d79271c1f0274111697975b527bf40b4c2a3f65239e2e03c0b91bb4a698e4665735aebdfaf54031ac6c8d2c78b8ee853f119694da7f14476900d59d9e072eebbb242d251384e616dc7307641cdd2b5ecccd2082347049b8c62863d06a7ef7e48d5460d253b5cea4b1b9b98ceddf274bf4f820f5f510be30db06c8fb037fd3aea35d89db5b5f9205c18e031bf333c46fe3ca5c183fc40b0bff0095d24cee07624f98b7eead7c6ea453b034346ba016e56d41091e9f047cc6ec6800f7fdba20054b3b986e36e6392b0f07c44bef95a5c06a72b49b79d94ec2785228a374921bbb290d6dbf51d079ab1306c2e38220d60b1cba91a5ee39a0aa311e25636e00d7d424caac72593f558744d3c6b875a40e1cf425240a7be9cd06c2705962df15fdecc76e96d94ba4209deddbf8513f0ab78a120a0fa3bfa77181457eaf71f9a7b6bc1d955fc154f27e0da35b66769ea9d68a0731feee96dee80fa55e2c6fe414d412df140fc8720a8c68a3558f0a9636516a878502dac5e9dd620c7bd4572d9eee8b99720e6412bac4d2b222a50b209d0ec14e87330870e4a25310a64b25820b128dc258eec1af4fadd4f632cdb1034fbdd57184634e8cd82353e2729958cb5ae45f5e47a209d50ed54fa3974b2853b6e56a0db6dd0318945803a2178be0d0d430fe976e1e0731a8bf5d97565569aadc4e4ec82ba156df6d6af362dd865f0bfbdff6469fc4905f2422e7601a354c5251432692b43877175da969a088de3635bdc003fda093875000d0f7df311b1fd3fed17865f1d9086d65dca445259e81278be8ef72ab78e8dae2077f82b9b1f607121537514803cea5a474e680b3b86dc35690eec0ebf02a33f0f9a178cc0b74bf458ca49080e1213db6b2991d74cf2227126ee02c75dcf741f4260b4c2382303fb4137d6e48d5140d5a42ccad0072007c97441881f108bc0ef247107c705e170ec82990b8d40f0aef6d5739f640aae1aaf56d2b755880607af4adbd915d04374119aeb2f04daa95241a28063b20210d4d94bfc466425a136607c3b2546beeb3fb8e9f041e61b4ee7b835a2e558d15230d8b8789bb150ea606d2439621e379b03cc92a6d3388163bf3f341c6a0eb7504baca6ccebdee879d904d66badeebb377ba8b4ed449ac24208af7f55a46e2e361ff004ba98b5442969c345d0408478881c9108a76b5de243b12a67c8d7084e57722763d9214787d6407da3e5ff934ea2df7b5905898d56c6e371d37553e31302f0e6f3b827af75e6258dba4395885fe1ce5d4a0eb4d525a7b7dea9c783e84cf58ce8df11f4dbe6905bbabdbfa7386e484cc7779b0f21fed0590bd5e2c41887628dbc4ef244544ae6de3779141479dcae528d0aef2fbc7cd7171d102cc9b958b7986ab104573acb889c5d793851a289ce366824f402ff4404bda68a0cad4c143c37572ed1903abb4faa3b4bc28448d12bda0ef941b92824f0af08b5cd134e2f7d5adedd4ab1b2d9b668007452c3435a072b28cfd9008f601f52cbea23639c7ced6087c6fb929970f843a593bb00f994b8c8ecef920e125af65c7229158cd2e1468a7bf2413230a7c63443d834d148f6b9507199e5b726cb94788176db7dee104c59924ff0096cf08beaefe16b0f0ec8dd1b3b80ee0206682371f10bf9209c4313c803af4fdd0f9b0baf68bc7287f6be53e9b8f9a5e9310af61f135c6ddb37d1044acc20b5c0805407c994805779b16aa90d882d1dc5bea85540933788dd016a1a232c8d63777380f8afa828a94451b636ecd007c153ffd3ac2bda49ed88f0b3407ab8ff015d283d5edd78b107ab854fba7c9765ce5d8a0a3eb07e63bcd4470dd10c49bf9aef3505001980cc562ed3c7e258819e2e1a8187c7771e84d87c0264a46c710b3230df2dfd4ae51b46fcd4a66a504ca8aecac2e3c85d57fc2b3baa6a2594f32003d029bc65887b38320dca8d8037f0d1c65bbdb33bbdf6082cf6baf65ebf7b2e4d903a30e6ec755b93a5d07b40eb5479b6df050715a2c8f246c755ebe4c92c4eff2b79df44d5574a246969f43d10578f92fa140a6390dc23f5d48e6137dc20154d25012a69aeba481018a674675dbe88d365ccdb841cdafb2e33d4585f5fe54b658f25acb131da1d1022e238d48c3f9648423ff00b64eddc2b31f1d344dd813dd2dd4cf0b813941f4408b362b24a7c47452e9299f3bdb1b05dce361f7d969534ad06ed16572ff004f3026323fc41b173ae073ca3f9281df04c2db4b03226f21a9ea79945d7817a83162f5620c5a48345bad5c8297c61996678ee858d91de2067e7b901403679082b17392ee37bfc97a82cc6b0aef1d82d80e8b479b025054fc6151ed2a1acbe83ea986b99ece307980dd3a36c90f10a9cd52e77477d15878a657bf230db3c4d7b41e4e02cf6791f780e5c903960cf06016370891366a56e11a8bc05bcda6c5344d7ca805e26e3918ee847d55811bae01ec903121e0b04d9824f9e061e82df041dabe844adefc8fecabeada22c758e8ad143710a0128efc8fec82b631022c541f6459ee9f4fe11f9e9cb6e2daf340aa262d4039f8ad8d8e8a3bf1e6754031ca963f4e7d798f50972384f9a064c53180e22c5087570cb617ed75c1b012764c183e0bed1db69cca0162866f62e9ce8d1b5ff513d1581fd30c6c87ba071d1dab7fe437f8a1bc6953969e38dba0bede492702ac30ccc78e441f9a0fadaebd51629bda31af65b500fa1525a83d5eaf1620f56ae5eac282a3e246da7297ada268e2965a54ac4a08120b1b058b7981bf35882c7a690385d70c49d96371ec8660b3fe83b85331a75a23d105211479a523bfeeadbc5b0f3ecd9233df65b2f7d3569eb75576166f5009fef1f556c713bcb694b87a1fa20e18054373973746c9bb7fb5e376909de09b35d8771f348f434b9dad999ef39a33376cda6e7bf71a8ee8b36a8870bfbdc8ff0070e60f71cfe280b491175feec8cf0e9fcb2de850fa5767693d42f3059b2cce6751f440e6b162c402311c3049e21a3be47b155c62b48e0e2c3b8df54efc51c4b1d0c599dab8fbace64ff03995f391c4a67c8e99cf399c6e75f80b7440cd2e0998eca7d1f0f5fc20127a0173ea87613c56d6380a8697b7fc7437efd7e4ae9e1ac6296a584d38b5b7691670f3ea3ba0446f0149a3de401cd837f53fb04623a30d6e568b0e6ac0a8a86b46a946593da49e10829fe3aa90e95b18d9adf994994eeb3879ee8ff13ffee49e683d3c177a0fa5782ab3da52341ddba7f09baeaacfe9f55805f193b8040eb6dd5a483d5eaf1620f57857abc4157f1734fb409533276e32dda914a0e2f76ab163aeb1035cb4d6787b74eaa2e3f559a123a6e88109738865c903adcee1057d85dfdab4ff0090faab538bcffe211d555b873acf69ff0021f5566f1a3cfe1dbe882670abef4d1f61a1443106df958ee3fe4021bc1bff00aed1e68ce237ca7b6a83304ad05d97ec152aaff2a56bfa1ffb4af864c454762dbd937e27187460a0746bae0150b10af6c2dccedf90e64ae5864fff008ec71fedfa247a995f3499dc7c8741d9029f1360d2d5b8c84dcf2e80740ab90cb1c846b7b7aafa7309a60753c9573fd47c304324757186dc9b16db723505054f5109612d22c4724edfd3fa874754c77e975d87d76f9a58c5b14352ecee6b43adfa74bfa754cfc24ffcb0798907ec82f0c421ce405c1d0b62612113647737ea84638fb06b7a94140713457aa711d07c54aa0e1ba82038377ee3e88fc58709b107e6d9b636eaac3644d6bb6d3a77415dc34ef85c342d239ed6568e078f896cc7e8eebc9dfed04c6c8036486daa2c972f276a3b20fa016253e1cc69d28c8fdc7eaebe69ac141b2c257975ac91870b1171d1021f18b3469ee9076562f186918f355c1720d1fbac5b82b107ffd9"}';
        // $hex= substr($hex, 4);
        // $hex= mb_substr($hex, 0, -2);
        // dd($hex);
        // $bin = hex2bin($hex);
        // $b64 = base64_encode($bin);
        // dd($b64);
        if($request->ano=='Todos'){
            $ano=NUll;
        }
        else{
            $ano=$request->ano;
        }
        $data= DB::SELECT("select * from reporte_cuatro(?)", [$ano]);
        // dd($data);
        foreach ($data as $item) {
            if($item->foto_piloto){
                try{
                    $hex= $item->foto_piloto;
                    $hex= substr($hex, 5);
                    $hex= mb_substr($hex, 0, -2);
                    $bin = hex2bin($hex);
                    $b64 = base64_encode($bin);
                    $item->foto_piloto= $b64;
                }
                catch(Exception $e){
                    $item->foto_piloto=NULL;
                }
            }
            if($item->foto_vehiculo){
                try{
                    $hex= $item->foto_vehiculo;
                    $hex= substr($hex, 5);
                    $hex= mb_substr($hex, 0, -2);
                    $bin = hex2bin($hex);
                    $b64 = base64_encode($bin);
                    $item->foto_vehiculo= $b64;
                }
                catch(Exception $e){
                    $item->foto_vehiculo=NULL;
                }
            }
        }
        // dd($data);
        return view('reportecuatro.resultados')
        ->with('data',$data);
    }


}
